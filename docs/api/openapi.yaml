openapi: 3.1.0
info:
  title: Benefits Enrollment MVP API
  version: 0.2.0
  description: Multi-tenant benefits enrollment API with role-based access controls.
servers:
  - url: http://localhost:4000

tags:
  - name: Health
  - name: Auth
  - name: Full Admin
  - name: Company Admin
  - name: Employee

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string
        details:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              message:
                type: string

    Role:
      type: string
      enum: [FULL_ADMIN, COMPANY_ADMIN, EMPLOYEE]

    InviteTargetRole:
      type: string
      enum: [COMPANY_ADMIN, EMPLOYEE]

    BenefitClass:
      type: string
      enum: [FULL_TIME_ELIGIBLE, INELIGIBLE]

    EmploymentStatus:
      type: string
      enum: [ACTIVE, TERMED]

    PlanType:
      type: string
      enum: [MEDICAL, DENTAL, VISION]

    CoverageTier:
      type: string
      enum: [EMPLOYEE_ONLY, EMPLOYEE_SPOUSE, EMPLOYEE_CHILDREN, FAMILY]

    DependentRelationship:
      type: string
      enum: [SPOUSE, CHILD]

    EnrollmentStatus:
      type: string
      enum: [DRAFT, SUBMITTED]

    AuthUser:
      type: object
      required: [id, email, role, tenantId]
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/Role'
        tenantId:
          type: [string, 'null']
          format: uuid
        sessionId:
          type: [string, 'null']
          format: uuid

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    LoginResponse:
      type: object
      required: [accessToken, refreshToken, user]
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/AuthUser'

    SignupInviteRequest:
      type: object
      required: [inviteCode, email, password]
      properties:
        inviteCode:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8

    RefreshRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    PasswordResetRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email

    PasswordResetConfirmRequest:
      type: object
      required: [token, newPassword]
      properties:
        token:
          type: string
        newPassword:
          type: string
          minLength: 8

    Tenant:
      type: object
      required: [id, companyId, name, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        companyId:
          type: string
        name:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    InviteCode:
      type: object
      required: [id, tenantId, code, targetRole, createdByUserId, usesCount, isActive, createdAt]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        code:
          type: string
        targetRole:
          $ref: '#/components/schemas/InviteTargetRole'
        createdByUserId:
          type: string
          format: uuid
        expiresAt:
          type: [string, 'null']
          format: date-time
        maxUses:
          type: [integer, 'null']
        usesCount:
          type: integer
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    User:
      type: object
      required: [id, tenantId, email, role, isActive, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: [string, 'null']
          format: uuid
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/Role'
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SecurityEvent:
      type: object
      required: [id, eventType, severity, createdAt]
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: [string, 'null']
          format: uuid
        tenantId:
          type: [string, 'null']
          format: uuid
        eventType:
          type: string
        severity:
          type: string
          enum: [INFO, WARN, ERROR]
        ipAddress:
          type: [string, 'null']
        userAgent:
          type: [string, 'null']
        metadata:
          type: [object, 'null']
          additionalProperties: true
        createdAt:
          type: string
          format: date-time

    PageInfo:
      type: object
      required: [limit, offset, returned, hasMore, nextOffset]
      properties:
        limit:
          type: integer
        offset:
          type: integer
        returned:
          type: integer
        hasMore:
          type: boolean
        nextOffset:
          type: [integer, 'null']

    EmployeeProfileInput:
      type: object
      required:
        - employeeId
        - firstName
        - lastName
        - dob
        - hireDate
        - salaryAmount
        - benefitClass
        - employmentStatus
      properties:
        employeeUserId:
          type: string
          format: uuid
          description: Required only for FULL_ADMIN calls to employee-scoped routes.
        employeeId:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        dob:
          type: string
          format: date
        hireDate:
          type: string
          format: date
        salaryAmount:
          type: number
        benefitClass:
          $ref: '#/components/schemas/BenefitClass'
        employmentStatus:
          $ref: '#/components/schemas/EmploymentStatus'

    EmployeeProfile:
      allOf:
        - $ref: '#/components/schemas/EmployeeProfileInput'
        - type: object
          required: [userId, tenantId, createdAt, updatedAt]
          properties:
            userId:
              type: string
              format: uuid
            tenantId:
              type: string
              format: uuid
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    PlanYear:
      type: object
      required: [id, tenantId, name, startDate, endDate, createdByUserId, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        name:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        createdByUserId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Plan:
      type: object
      required: [id, tenantId, planYearId, type, carrier, planName, isActive, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        planYearId:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/PlanType'
        carrier:
          type: string
        planName:
          type: string
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PlanPremiumInput:
      type: object
      required: [coverageTier, employeeMonthlyCost, employerMonthlyCost]
      properties:
        coverageTier:
          $ref: '#/components/schemas/CoverageTier'
        employeeMonthlyCost:
          type: number
          minimum: 0
        employerMonthlyCost:
          type: number
          minimum: 0

    PlanPremium:
      allOf:
        - $ref: '#/components/schemas/PlanPremiumInput'
        - type: object
          required: [id, planId, createdAt, updatedAt]
          properties:
            id:
              type: string
              format: uuid
            planId:
              type: string
              format: uuid
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    Dependent:
      type: object
      required: [id, tenantId, employeeUserId, relationship, firstName, lastName, dob, createdAt, updatedAt]
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        employeeUserId:
          type: string
          format: uuid
        relationship:
          $ref: '#/components/schemas/DependentRelationship'
        firstName:
          type: string
        lastName:
          type: string
        dob:
          type: string
          format: date
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EnrollmentElection:
      type: object
      required: [planType, planId, coverageTier, employeeMonthlyCost, employerMonthlyCost]
      properties:
        planType:
          $ref: '#/components/schemas/PlanType'
        planId:
          type: string
          format: uuid
        coverageTier:
          $ref: '#/components/schemas/CoverageTier'
        employeeMonthlyCost:
          type: number
        employerMonthlyCost:
          type: number

    Enrollment:
      type: object
      required:
        - id
        - tenantId
        - employeeUserId
        - planYearId
        - status
        - effectiveDate
        - submittedAt
        - confirmationCode
        - elections
        - dependentIds
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
        tenantId:
          type: string
          format: uuid
        employeeUserId:
          type: string
          format: uuid
        planYearId:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/EnrollmentStatus'
        effectiveDate:
          type: [string, 'null']
          format: date
        submittedAt:
          type: [string, 'null']
          format: date-time
        confirmationCode:
          type: [string, 'null']
        elections:
          type: array
          items:
            $ref: '#/components/schemas/EnrollmentElection'
        dependentIds:
          type: array
          items:
            type: string
            format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateTenantRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        companyId:
          type: string

    CreateInviteCodeRequest:
      type: object
      properties:
        expiresAt:
          type: string
          format: date-time
        maxUses:
          type: integer
          minimum: 1

    CreatePlanYearRequest:
      type: object
      required: [name, startDate, endDate]
      properties:
        name:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date

    CreatePlanRequest:
      type: object
      required: [planYearId, type, carrier, planName]
      properties:
        planYearId:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/PlanType'
        carrier:
          type: string
        planName:
          type: string

    SetPlanPremiumsRequest:
      type: object
      required: [tiers]
      properties:
        tiers:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/PlanPremiumInput'

    CreateDependentRequest:
      type: object
      required: [relationship, firstName, lastName, dob]
      properties:
        employeeUserId:
          type: string
          format: uuid
          description: Required only for FULL_ADMIN calls.
        relationship:
          $ref: '#/components/schemas/DependentRelationship'
        firstName:
          type: string
        lastName:
          type: string
        dob:
          type: string
          format: date

    EnrollmentElectionInput:
      type: object
      required: [planType, planId, coverageTier]
      properties:
        planType:
          $ref: '#/components/schemas/PlanType'
        planId:
          type: string
          format: uuid
        coverageTier:
          $ref: '#/components/schemas/CoverageTier'

    CreateEnrollmentDraftRequest:
      type: object
      required: [planYearId, elections]
      properties:
        employeeUserId:
          type: string
          format: uuid
        planYearId:
          type: string
          format: uuid
        elections:
          type: array
          items:
            $ref: '#/components/schemas/EnrollmentElectionInput'
        dependentIds:
          type: array
          items:
            type: string
            format: uuid

    SubmitEnrollmentRequest:
      type: object
      properties:
        employeeUserId:
          type: string
          format: uuid

    MessageResponse:
      type: object
      required: [message]
      properties:
        message:
          type: string
        resetToken:
          type: string

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unauthorized:
              value:
                error: Invalid or expired token

    ValidationError:
      description: Validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalid:
              value:
                error: Validation failed
                details:
                  - path: email
                    message: Invalid email

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
              examples:
                ok:
                  value: { status: ok }

  /auth/login:
    post:
      tags: [Auth]
      summary: Login with email/password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              examples:
                login:
                  value:
                    accessToken: jwt-token
                    refreshToken: refresh-token
                    user:
                      id: 8f530abe-7332-4df1-9727-a8527dbffb1e
                      email: platform-admin@example.com
                      role: FULL_ADMIN
                      tenantId: null
                      sessionId: 1f530abe-7332-4df1-9727-a8527dbffb1e
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          description: Too many login attempts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/signup-invite:
    post:
      tags: [Auth]
      summary: Create account using invite code
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupInviteRequest'
      responses:
        '201':
          description: Account created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/ValidationError'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Rotate refresh token and issue new access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Revoke refresh token session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '204':
          description: Logged out

  /auth/logout-all:
    post:
      tags: [Auth]
      summary: Revoke all sessions for current user
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Logged out from all sessions
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/password-reset/request:
    post:
      tags: [Auth]
      summary: Request password reset token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
      responses:
        '200':
          description: Password reset request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'

  /auth/password-reset/confirm:
    post:
      tags: [Auth]
      summary: Confirm password reset using token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetConfirmRequest'
      responses:
        '200':
          description: Password reset complete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/ValidationError'

  /full-admin/tenants:
    get:
      tags: [Full Admin]
      summary: List all tenants
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 25
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Tenant list
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenants:
                    type: array
                    items:
                      $ref: '#/components/schemas/Tenant'
                  page:
                    $ref: '#/components/schemas/PageInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [Full Admin]
      summary: Create tenant
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTenantRequest'
      responses:
        '201':
          description: Tenant created
          content:
            application/json:
              schema:
                type: object
                properties:
                  tenant:
                    $ref: '#/components/schemas/Tenant'

  /full-admin/tenants/{tenantId}/invite-codes/company-admin:
    post:
      tags: [Full Admin]
      summary: Create company admin invite code
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteCodeRequest'
      responses:
        '201':
          description: Invite code created
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviteCode:
                    $ref: '#/components/schemas/InviteCode'

  /full-admin/security-events:
    get:
      tags: [Full Admin]
      summary: List security events across tenants
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 25
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: severity
          in: query
          required: false
          schema:
            type: string
            enum: [INFO, WARN, ERROR]
        - name: eventType
          in: query
          required: false
          schema:
            type: string
        - name: q
          in: query
          required: false
          schema:
            type: string
        - name: export
          in: query
          required: false
          schema:
            type: string
            enum: [json, csv]
            default: json
      responses:
        '200':
          description: Security events (JSON or CSV export)
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/SecurityEvent'
                  page:
                    $ref: '#/components/schemas/PageInfo'
            text/csv:
              schema:
                type: string

  /tenants/{tenantId}/company-admin/users:
    get:
      tags: [Company Admin]
      summary: List tenant users
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: role
          in: query
          required: false
          schema:
            type: string
            enum: [COMPANY_ADMIN, EMPLOYEE]
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 25
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Users list
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  page:
                    $ref: '#/components/schemas/PageInfo'

  /tenants/{tenantId}/company-admin/employee-profiles:
    get:
      tags: [Company Admin]
      summary: List employee profiles
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Employee profile list
          content:
            application/json:
              schema:
                type: object
                properties:
                  profiles:
                    type: array
                    items:
                      $ref: '#/components/schemas/EmployeeProfile'

  /tenants/{tenantId}/company-admin/security-events:
    get:
      tags: [Company Admin]
      summary: List security events for tenant
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 25
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: severity
          in: query
          required: false
          schema:
            type: string
            enum: [INFO, WARN, ERROR]
        - name: eventType
          in: query
          required: false
          schema:
            type: string
        - name: q
          in: query
          required: false
          schema:
            type: string
        - name: export
          in: query
          required: false
          schema:
            type: string
            enum: [json, csv]
            default: json
      responses:
        '200':
          description: Tenant security events (JSON or CSV export)
          content:
            application/json:
              schema:
                type: object
                properties:
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/SecurityEvent'
                  page:
                    $ref: '#/components/schemas/PageInfo'
            text/csv:
              schema:
                type: string

  /tenants/{tenantId}/company-admin/invite-codes/employee:
    post:
      tags: [Company Admin]
      summary: Create employee invite code
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInviteCodeRequest'
      responses:
        '201':
          description: Invite code created
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviteCode:
                    $ref: '#/components/schemas/InviteCode'

  /tenants/{tenantId}/company-admin/employees/{employeeUserId}/profile:
    put:
      tags: [Company Admin]
      summary: Upsert employee profile
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: employeeUserId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeProfileInput'
      responses:
        '200':
          description: Employee profile saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/EmployeeProfile'

  /tenants/{tenantId}/company-admin/plan-years:
    get:
      tags: [Company Admin]
      summary: List plan years for tenant
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plan year list
          content:
            application/json:
              schema:
                type: object
                properties:
                  planYears:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlanYear'
    post:
      tags: [Company Admin]
      summary: Create plan year
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlanYearRequest'
      responses:
        '201':
          description: Plan year created
          content:
            application/json:
              schema:
                type: object
                properties:
                  planYear:
                    $ref: '#/components/schemas/PlanYear'

  /tenants/{tenantId}/company-admin/plans:
    get:
      tags: [Company Admin]
      summary: List plans for tenant
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: planYearId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plan list
          content:
            application/json:
              schema:
                type: object
                properties:
                  plans:
                    type: array
                    items:
                      $ref: '#/components/schemas/Plan'
    post:
      tags: [Company Admin]
      summary: Create plan
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePlanRequest'
      responses:
        '201':
          description: Plan created
          content:
            application/json:
              schema:
                type: object
                properties:
                  plan:
                    $ref: '#/components/schemas/Plan'

  /tenants/{tenantId}/company-admin/plans/{planId}/premiums:
    put:
      tags: [Company Admin]
      summary: Replace plan premium tiers
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: planId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetPlanPremiumsRequest'
      responses:
        '200':
          description: Premiums updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  premiums:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlanPremium'

  /tenants/{tenantId}/employee/plan-years:
    get:
      tags: [Employee]
      summary: List tenant plan years
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plan years listed
          content:
            application/json:
              schema:
                type: object
                properties:
                  planYears:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlanYear'

  /tenants/{tenantId}/employee/plans:
    get:
      tags: [Employee]
      summary: List tenant plans
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: planYearId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plans listed
          content:
            application/json:
              schema:
                type: object
                properties:
                  plans:
                    type: array
                    items:
                      $ref: '#/components/schemas/Plan'

  /tenants/{tenantId}/employee/profile:
    put:
      tags: [Employee]
      summary: Upsert employee profile
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmployeeProfileInput'
      responses:
        '200':
          description: Employee profile saved
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/EmployeeProfile'

  /tenants/{tenantId}/employee/dependents:
    get:
      tags: [Employee]
      summary: List employee dependents
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: employeeUserId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dependents listed
          content:
            application/json:
              schema:
                type: object
                properties:
                  dependents:
                    type: array
                    items:
                      $ref: '#/components/schemas/Dependent'
    post:
      tags: [Employee]
      summary: Add dependent
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDependentRequest'
      responses:
        '201':
          description: Dependent created
          content:
            application/json:
              schema:
                type: object
                properties:
                  dependent:
                    $ref: '#/components/schemas/Dependent'

  /tenants/{tenantId}/employee/enrollments:
    get:
      tags: [Employee]
      summary: List employee enrollments
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: employeeUserId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Enrollments listed
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrollments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Enrollment'

  /tenants/{tenantId}/employee/enrollments/draft:
    post:
      tags: [Employee]
      summary: Create enrollment draft
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnrollmentDraftRequest'
      responses:
        '201':
          description: Draft created
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrollment:
                    $ref: '#/components/schemas/Enrollment'

  /tenants/{tenantId}/employee/enrollments/{enrollmentId}/submit:
    post:
      tags: [Employee]
      summary: Submit enrollment
      security:
        - bearerAuth: []
      parameters:
        - name: tenantId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: enrollmentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitEnrollmentRequest'
      responses:
        '200':
          description: Enrollment submitted
          content:
            application/json:
              schema:
                type: object
                properties:
                  enrollment:
                    $ref: '#/components/schemas/Enrollment'
